<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Japanese Translation Diagnostic</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 40px; }
        .test-section { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .test-card { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .translation-key { color: #666; font-size: 12px; }
        .result { font-weight: bold; font-size: 18px; margin: 5px 0; }
        .analysis { color: #888; font-size: 14px; }
        button { padding: 10px 20px; margin: 10px; font-size: 16px; cursor: pointer; }
        .debug-info { background: #eef; padding: 15px; border-radius: 5px; font-family: monospace; white-space: pre-line; }
    </style>
</head>
<body>
    <h1>üáØüáµ Japanese Translation Diagnostic Tool</h1>
    <p>This diagnostic will help identify why Japanese translations are showing mixed content.</p>
    
    <div class="test-section">
        <h2>Browser Information</h2>
        <div class="debug-info" id="browserInfo"></div>
    </div>
    
    <div class="test-section">
        <h2>Translation Test</h2>
        <button onclick="testJapaneseTranslations()">üîÑ Test Japanese Translations</button>
        <button onclick="clearAllCache()">üóëÔ∏è Clear Cache & Reload</button>
        
        <div class="test-card">
            <div class="translation-key">tests.mbti.title</div>
            <div class="result" data-translate="tests.mbti.title">16 Personalities (MBTI)</div>
            <div class="analysis" id="mbti-analysis"></div>
        </div>
        
        <div class="test-card">
            <div class="translation-key">tests.bigfive.title</div>
            <div class="result" data-translate="tests.bigfive.title">Big Five Personality</div>
            <div class="analysis" id="bigfive-analysis"></div>
        </div>
        
        <div class="test-card">
            <div class="translation-key">tests.takeTest</div>
            <div class="result" data-translate="tests.takeTest">Take Test</div>
            <div class="analysis" id="taketest-analysis"></div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Debug Information</h2>
        <div class="debug-info" id="debugInfo"></div>
    </div>
    
    <script>
        // Minimal Japanese translations for testing
        const translations = {
            ja: {
                tests: {
                    mbti: {
                        title: "16„ÅÆÊÄßÊ†º„Çø„Ç§„Éó"
                    },
                    bigfive: {
                        title: "„Éì„ÉÉ„Ç∞„Éï„Ç°„Ç§„ÉñÊÄßÊ†º„ÉÜ„Çπ„Éà"
                    },
                    takeTest: "„ÉÜ„Çπ„Éà„ÇíÈñãÂßã"
                }
            }
        };
        
        function analyzeText(text, expectedText) {
            const hasJapanese = /[„Å≤„Çâ„Åå„Å™„Ç´„Çø„Ç´„Éä‰∏Ä-ÈæØ]/.test(text);
            const hasEnglish = /[a-zA-Z]/.test(text);
            const hasKorean = /[„Ñ±-„Öé|„Öè-„Ö£|Í∞Ä-Ìû£]/.test(text);
            const hasChinese = /[\u4e00-\u9fff]/.test(text);
            const isCorrect = text === expectedText;
            const isMixed = (hasJapanese && hasEnglish) || (hasJapanese && hasKorean) || (hasEnglish && hasKorean);
            
            const characterBreakdown = text.split('').map(char => {
                if (/[„Å≤„Çâ„Åå„Å™„Ç´„Çø„Ç´„Éä‰∏Ä-ÈæØ]/.test(char)) return `${char}(JP)`;
                if (/[a-zA-Z]/.test(char)) return `${char}(EN)`;
                if (/[„Ñ±-„Öé|„Öè-„Ö£|Í∞Ä-Ìû£]/.test(char)) return `${char}(KR)`;
                if (/[\u4e00-\u9fff]/.test(char)) return `${char}(CN)`;
                return char;
            }).join('');
            
            return {
                text,
                hasJapanese,
                hasEnglish,
                hasKorean,
                hasChinese,
                isCorrect,
                isMixed,
                characterBreakdown,
                status: isCorrect ? '‚úÖ CORRECT' : (isMixed ? '‚ùå MIXED CONTENT' : '‚ö†Ô∏è WRONG LANGUAGE')
            };
        }
        
        function updateAnalysis(elementId, analysis, expected) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                Status: ${analysis.status}
                Expected: "${expected}"
                Actual: "${analysis.text}"
                Has Japanese: ${analysis.hasJapanese}
                Has English: ${analysis.hasEnglish}
                Has Korean: ${analysis.hasKorean}
                Is Mixed: ${analysis.isMixed}
                Character Breakdown: ${analysis.characterBreakdown}
            `;
        }
        
        function testJapaneseTranslations() {
            console.log('üáØüáµ Testing Japanese translations...');
            
            // Apply translations
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                const keys = key.split('.');
                let value = translations.ja;
                
                for (let k of keys) {
                    value = value[k];
                    if (!value) break;
                }
                
                if (value) {
                    element.textContent = value;
                    console.log(`‚úÖ Updated ${key}: "${value}"`);
                } else {
                    console.log(`‚ùå No translation for ${key}`);
                }
            });
            
            // Analyze results
            setTimeout(() => {
                const mbtiElement = document.querySelector('[data-translate="tests.mbti.title"]');
                const bigfiveElement = document.querySelector('[data-translate="tests.bigfive.title"]');
                const takeTestElement = document.querySelector('[data-translate="tests.takeTest"]');
                
                const mbtiAnalysis = analyzeText(mbtiElement.textContent, "16„ÅÆÊÄßÊ†º„Çø„Ç§„Éó");
                const bigfiveAnalysis = analyzeText(bigfiveElement.textContent, "„Éì„ÉÉ„Ç∞„Éï„Ç°„Ç§„ÉñÊÄßÊ†º„ÉÜ„Çπ„Éà");
                const takeTestAnalysis = analyzeText(takeTestElement.textContent, "„ÉÜ„Çπ„Éà„ÇíÈñãÂßã");
                
                updateAnalysis('mbti-analysis', mbtiAnalysis, "16„ÅÆÊÄßÊ†º„Çø„Ç§„Éó");
                updateAnalysis('bigfive-analysis', bigfiveAnalysis, "„Éì„ÉÉ„Ç∞„Éï„Ç°„Ç§„ÉñÊÄßÊ†º„ÉÜ„Çπ„Éà");
                updateAnalysis('taketest-analysis', takeTestAnalysis, "„ÉÜ„Çπ„Éà„ÇíÈñãÂßã");
                
                // Update debug info
                const debugInfo = document.getElementById('debugInfo');
                debugInfo.textContent = `
Translation Test Results:
- MBTI: ${mbtiAnalysis.status}
- BigFive: ${bigfiveAnalysis.status}
- Take Test: ${takeTestAnalysis.status}

Potential Issues:
${mbtiAnalysis.isMixed || bigfiveAnalysis.isMixed || takeTestAnalysis.isMixed ? '- Mixed language content detected' : '- No mixed content detected'}
${!mbtiAnalysis.hasJapanese || !bigfiveAnalysis.hasJapanese || !takeTestAnalysis.hasJapanese ? '- Missing Japanese characters' : '- Japanese characters present'}

Recommendations:
1. If you see mixed content here too, the issue is browser-specific
2. Try disabling browser auto-translation in Chrome/Edge settings
3. Disable any translation extensions temporarily
4. Clear browser cache completely (Ctrl+Shift+Del)
5. Try opening in incognito/private mode
                `;
            }, 100);
        }
        
        function clearAllCache() {
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            localStorage.clear();
            sessionStorage.clear();
            location.reload(true);
        }
        
        function initBrowserInfo() {
            const browserInfo = document.getElementById('browserInfo');
            browserInfo.textContent = `
Browser: ${navigator.userAgent}
Language: ${navigator.language}
Languages: ${navigator.languages.join(', ')}
Platform: ${navigator.platform}
Cookies Enabled: ${navigator.cookieEnabled}
Java Enabled: ${navigator.javaEnabled()}
Online: ${navigator.onLine}
            `;
        }
        
        // Initialize on load
        window.onload = function() {
            initBrowserInfo();
            console.log('Japanese Diagnostic Tool loaded');
        };
    </script>
</body>
</html>